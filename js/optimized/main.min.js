/* WeBuy - Optimized JavaScript */
(function(){'use strict';const supportsIntersectionObserver='IntersectionObserver' in window;const supportsResizeObserver='ResizeObserver' in window;const supportsFetch='fetch' in window;const supportsLocalStorage='localStorage' in window;const supportsSessionStorage='sessionStorage' in window;const supportsCustomProperties=getComputedStyle(document.documentElement).getPropertyValue('--color-primary-600')!=='';const supportsGrid=getComputedStyle(document.documentElement).getPropertyValue('display')==='grid';const supportsFlexbox=getComputedStyle(document.documentElement).getPropertyValue('display')==='flex';document.documentElement.classList.add('supports-intersection-observer','supports-resize-observer','supports-fetch','supports-local-storage','supports-session-storage','supports-custom-properties','supports-grid','supports-flexbox');if(supportsIntersectionObserver){const lazyImages=document.querySelectorAll('img[loading="lazy"]');const imageObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;img.classList.add('loaded');observer.unobserve(img)}})});lazyImages.forEach(img=>imageObserver.observe(img))}class ToastManager{constructor(){this.container=this.createContainer();this.toasts=new Map()}createContainer(){let container=document.querySelector('.toast-container');if(!container){container=document.createElement('div');container.className='toast-container';document.body.appendChild(container)}return container}show(message,type='info',duration=5000){const toast=document.createElement('div');toast.className=`toast toast--${type}`;toast.innerHTML=`<div class="toast__content">${message}</div><button class="toast__close" aria-label="Close">Ã—</button>`;const closeBtn=toast.querySelector('.toast__close');closeBtn.addEventListener('click',()=>this.hide(toast));this.container.appendChild(toast);const toastId=Date.now();this.toasts.set(toastId,toast);if(duration>0){setTimeout(()=>this.hide(toast),duration)}return toastId}hide(toast){if(toast.classList.contains('toast--exiting'))return;toast.classList.add('toast--exiting');setTimeout(()=>{if(toast.parentNode)toast.parentNode.removeChild(toast)},300)}}class ModalManager{constructor(){this.activeModal=null;this.backdrop=null;this.init()}init(){document.addEventListener('click',e=>{if(e.target.matches('[data-modal]')){e.preventDefault();this.open(e.target.dataset.modal)}if(e.target.matches('.modal-close')){e.preventDefault();this.close()}});document.addEventListener('keydown',e=>{if(e.key==='Escape'&&this.activeModal){this.close()}})}open(modalId){const modal=document.getElementById(modalId);if(!modal)return;this.activeModal=modal;this.backdrop=document.createElement('div');this.backdrop.className='modal-backdrop';document.body.appendChild(this.backdrop);modal.classList.add('modal--visible');document.body.style.overflow='hidden';this.trapFocus(modal);setTimeout(()=>modal.focus(),100)}close(){if(!this.activeModal)return;this.activeModal.classList.remove('modal--visible');if(this.backdrop)this.backdrop.remove();document.body.style.overflow='';this.activeModal=null;this.backdrop=null}trapFocus(modal){const focusableElements=modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');const firstElement=focusableElements[0];const lastElement=focusableElements[focusableElements.length-1];modal.addEventListener('keydown',e=>{if(e.key==='Tab'){if(e.shiftKey){if(document.activeElement===firstElement){e.preventDefault();lastElement.focus()}}else{if(document.activeElement===lastElement){e.preventDefault();firstElement.focus()}}}})}}const toastManager=new ToastManager();const modalManager=new ModalManager();function updateFeatureStatus(){const features={'CSS Grid':supportsGrid,'CSS Flexbox':supportsFlexbox,'CSS Custom Properties':supportsCustomProperties,'Intersection Observer':supportsIntersectionObserver,'Resize Observer':supportsResizeObserver,'Fetch API':supportsFetch,'Local Storage':supportsLocalStorage,'Session Storage':supportsSessionStorage};Object.entries(features).forEach(([name,supported])=>{const element=document.querySelector(`[data-feature="${name}"]`);if(element){element.textContent=supported?'Supported':'Not Supported';element.className=supported?'feature-supported':'feature-not-supported'}})}function updatePerformanceMetrics(){const loadTime=performance.now();const domContentLoaded=performance.getEntriesByType('navigation')[0]?.domContentLoadedEventEnd||0;console.log(`Page load time: ${loadTime.toFixed(2)} seconds`);console.log(`DOM Content Loaded: ${domContentLoaded.toFixed(2)}`);const metricsElement=document.getElementById('performance-metrics');if(metricsElement){metricsElement.innerHTML=`<p>Load Time: ${loadTime.toFixed(2)}s</p><p>DOM Ready: ${domContentLoaded.toFixed(2)}s</p>`}}document.addEventListener('DOMContentLoaded',()=>{updateFeatureStatus();setTimeout(()=>{const slideElements=document.querySelectorAll('.slide-in-left, .slide-in-right');slideElements.forEach(el=>{el.style.animation='none';el.offsetHeight;el.style.animation=null})},100);window.addEventListener('load',()=>{setTimeout(updatePerformanceMetrics,100)})});window.retriggerAnimations=function(){const slideElements=document.querySelectorAll('.slide-in-left, .slide-in-right');slideElements.forEach(el=>{el.style.animation='none';el.offsetHeight;el.style.animation=null})};window.showToast=function(type='info'){const messages={success:'Success! This is a success message.',warning:'Warning! This is a warning message.',danger:'Error! This is an error message.',info:'Info! This is an info message.'};toastManager.show(messages[type],type)};window.openModal=function(modalId='test-modal'){modalManager.open(modalId)}})();